# # docker-compose.yml (simplified)
# services:
#   proxy:
#     build:
#       context: ./proxy
#     ports:
#       - "3001:3001"
#     extra_hosts:
#       - "host.docker.internal:9200"  # Ensures compatibility on Linux
#     restart: unless-stopped

#   frontend:
#     build:
#       context: ./frontend
#     ports:
#       - "80:80"
#     depends_on:
#       - proxy
#     restart: unless-stopped


# docker-compose.yml
# docker-compose.yml
services:
  proxy:
    build:
      context: ./proxy
    ports:
      - "${PROXY_PORT}:3001"
    env_file:
      - ./.env
    environment:
      OPENSEARCH_HOST: ${OPENSEARCH_HOST}
      OPENSEARCH_PORT: ${OPENSEARCH_PORT}
      OPENSEARCH_USERNAME: ${OPENSEARCH_USERNAME}
      OPENSEARCH_PASSWORD: ${OPENSEARCH_PASSWORD}
      OPENSEARCH_SCHEME: ${OPENSEARCH_SCHEME}
      OPENSEARCH_INSECURE_SSL: ${OPENSEARCH_INSECURE_SSL}
      ADMIN_USER: ${ADMIN_USER}
      ADMIN_PASS: ${ADMIN_PASS}
      DEFAULT_TEAM: ${DEFAULT_TEAM}
      AUTH_TOKEN_TTL_MINUTES: ${AUTH_TOKEN_TTL_MINUTES}
      DEFAULT_INDEX_PATTERN: ${DEFAULT_INDEX_PATTERN}
      DEFAULT_TIME_ZONE: ${DEFAULT_TIME_ZONE}
      MAX_EXPORT_SIZE: ${MAX_EXPORT_SIZE}
      DARK_MODE_DEFAULT: ${DARK_MODE_DEFAULT}
      FIELD_EXPLORER_FIELDS: ${FIELD_EXPLORER_FIELDS}
      FIELD_EXPLORER_TOPN: ${FIELD_EXPLORER_TOPN}
      CACHE_TTL_MS: ${CACHE_TTL_MS}
      CACHE_MAX_ENTRIES: ${CACHE_MAX_ENTRIES}
      LOG_RETENTION_DAYS: ${LOG_RETENTION_DAYS}
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
      ALERT_EMAIL_TO: ${ALERT_EMAIL_TO}
      ALERT_EMAIL_FROM: ${ALERT_EMAIL_FROM}
      IMPORT_UI_VISIBLE: ${IMPORT_UI_VISIBLE}
      IMPORT_ENABLED: ${IMPORT_ENABLED}
      IMPORT_MAX_FILE_BYTES: ${IMPORT_MAX_FILE_BYTES}
      IMPORT_BATCH_SIZE: ${IMPORT_BATCH_SIZE}
      IMPORT_AUTO_CREATE_INDEX: ${IMPORT_AUTO_CREATE_INDEX}
      IMPORT_INDEX_RETENTION_ENABLED: ${IMPORT_INDEX_RETENTION_ENABLED}
      IMPORT_INDEX_RETENTION_DAYS: ${IMPORT_INDEX_RETENTION_DAYS}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./proxy/data:/app/data
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
    ports:
      - "${WEB_PORT}:80"
    depends_on:
      - proxy
    restart: unless-stopped
